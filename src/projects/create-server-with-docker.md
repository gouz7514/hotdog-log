---
title: '도커를 활용한 서버 구축'
---

### 목표
- 도커를 활용해 인포크링크의 서버를 새롭게 구축하기 위한 프로젝트입니다.
- **더 빠른 오케스트레이션, 더 많은 부하를 감당할 수 있는 서버 아키텍처의 구현**을 목표로 합니다.

### 상세
#### 1. 테크스펙 작성 및 아키텍처 설계
특정 시간대에 트래픽이 몰리는 서비스 특성상 '빠르고 간단한 오케스트레이션'을 주요 요구 사항으로 프로젝트를 진행했습니다.

##### 1-1. ECS
기존의 인포크링크 서버는 AWS Elastic Beanstalk로 구성되어 있었습니다.
Beanstalk는 사용이 간단하다는 장점이 있으나 오케스트레이션이 느리다는 단점이 있었습니다.

인포크링크 웹 스택은 이미 ECS를 사용 중이었기에 서버 스택 또한 ECS로의 이전을 통해 편리하고 포괄적인 관리가 가능하도록 ECS를 선택했습니다. ECS를 활용하면 편리한 컨테이너의 관리, 태스크 및 서비스 관리, 로드 밸런싱, 오토 스케일링 등 안정적인 서비스의 제공이 가능합니다.

##### 1-2. Nginx
Django API 서버를 구동하는 runserver 커맨드의 보안, 성능상 이슈로 인해 nginx를 함께 구성했습니다.
nginx는 django 컨테이너 앞단에 추가되어 리버스 프록시로서의 역할을 하며, 클라이언트의 요청을 분산시켜주고 많은 트래픽을 동시에 처리할 수 있게 해줍니다.

##### 1-3. EC2 vs Fargate
CPU 사용륭이 예측 가능하고 안정적인 시스템에서 더 높은 효율을 발휘하는 EC2와 달리, Fargate는 유동적인 workload가 나타나는 환경에서 더 높은 효율을 발휘합니다.
스케일링의 빈도가 잦고 평소 상대적으로 낮은 workload가 부여되는 서비스 특성상 Fargate를 선택했습니다.

##### 1-5. 보안 설정
ECS 서비스 앞단에서 작동하는 로드 밸런서만을 통해 ECS에 접속할 수 있도록 보안 설정을 진행했습니다.
ECS 서비스에는 로드 밸런서와 ElasticCache와의 통신을 위한 포트만 열려있느 보안 그룹을 설정하고, 프라이빗 서브넷에서 실행되도록 설정했습니다.
추가로, 외부 인터넷으로부터의 접속을 차단한 뒤, 특정 보안 그룹에서의 접속만을 허용해 안전한 서버 아키텍처를 구성했습니다.

#### 2. 테스트 및 배포
ECS를 활용해 서버를 배포한 뒤 실제 서비스 환경과 비슷한 부하를 주어가며 스트레스 테스트를 진행했습니다. 이 과정에서 nginx, django 컨테이너의 CPU 할당량을 조젏해 최적의 성능을 발휘할 수 있도록 했습니다.

#### 3. AWS CDK
ECS의 태스크 및 서비스를 조절하고 배포하는 복잡한 과정을 코드를 통해 간단하게 관리할 수 있도록 AWS CDK를 활용해 배포했습니다. 이를 통해 개발자 누구나 서버 이미지를 관리하고 배포할 수 있게 됩니다.

### 결론
- 더 빠르고 간단한 오케스트레이션이 가능한 서버 아키텍처를 구성했습니다.
- AWS CDK를 활용, 누구나 배포 가능한 서버 스택을 구성했습니다.
- 해당 프로젝트 내용을 [회사 블로그](https://medium.com/ab-z/%EA%B8%89%EA%B2%A9%ED%95%98%EA%B2%8C-%EC%A6%9D%EA%B0%80%ED%95%98%EB%8A%94-%ED%8A%B8%EB%9E%98%ED%94%BD-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%8C%80%EB%B9%84%ED%95%A0%EA%B9%8C-d92f2fbf2130)와 [개인 블로그](https://velog.io/@gouz7514/ECS%EC%99%80-Docker-%EC%82%AC%EC%9A%A9%EA%B8%B0-0%EB%B6%80-%EC%84%9C%EB%A1%A0)에 기고했습니다.